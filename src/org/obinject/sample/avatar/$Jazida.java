package org.obinject.sample.avatar; import org.obinject.block.Page; import org.obinject.block.PullPage; import org.obinject.block.PushPage; import org.obinject.device.File; import org.obinject.exception.TransientObjectException; import org.obinject.meta.Entity; import org.obinject.meta.Uuid; import org.obinject.queries.Attribute; import org.obinject.queries.Schema; import org.obinject.storage.BTree; import org.obinject.storage.BTreeEntity; import org.obinject.storage.EntityStructure; import org.obinject.storage.KeyStructure; import org.obinject.storage.Structure; public class $Jazida extends Jazida implements Entity<$Jazida> { protected Uuid uuid; private static Uuid classId; public static Uuid getClassId(){ if ($Jazida.classId == null) {$Jazida.classId = Uuid.fromString("CFD009B5-B5C1-3975-CE5C-3335401F8FFB"); }return $Jazida.classId; } public static final BTreeEntity<$Jazida> entityStructure = new BTreeEntity<$Jazida>(new File("build/classes/org/obinject/sample/avatar/avatar.dbo", 4096)){}; public static final BTree<UniqueOneJazida> uniqueOneJazidaStructure = new BTree<UniqueOneJazida>(new File("build/classes/org/obinject/sample/avatar/avatar.dbo", 4096)){}; public static final Attribute<Integer> base = new Attribute<Integer> (){ @Override public Integer valueOfAttribute(Entity entity) { return ((Jazida)entity).getBase(); } }; public static final Attribute<Integer> altura = new Attribute<Integer> (){ @Override public Integer valueOfAttribute(Entity entity) { return ((Jazida)entity).getAltura(); } }; public static final Attribute<Integer> latitude = new Attribute<Integer> (){ @Override public Integer valueOfAttribute(Entity entity) { return ((Jazida)entity).getLatitude(); } }; public static final Attribute<Integer> longitude = new Attribute<Integer> (){ @Override public Integer valueOfAttribute(Entity entity) { return ((Jazida)entity).getLongitude(); } }; public static final Attribute<Boolean> povoada = new Attribute<Boolean> (){ @Override public Boolean valueOfAttribute(Entity entity) { return ((Jazida)entity).isPovoada(); } }; public static final Attribute<Boolean> explorada = new Attribute<Boolean> (){ @Override public Boolean valueOfAttribute(Entity entity) { return ((Jazida)entity).isExplorada(); } }; public static final Attribute<org.obinject.sample.avatar.Regiao> regiao = new Attribute<org.obinject.sample.avatar.Regiao> (){ @Override public org.obinject.sample.avatar.Regiao valueOfAttribute(Entity entity) { return ((Jazida)entity).getRegiao(); } }; public static final Attribute<java.util.List> colonias = new Attribute<java.util.List> (){ @Override public java.util.List valueOfAttribute(Entity entity) { return ((Jazida)entity).getColonias(); } }; public static final Attribute<java.util.List> maquinas = new Attribute<java.util.List> (){ @Override public java.util.List valueOfAttribute(Entity entity) { return ((Jazida)entity).getMaquinas(); } }; public static final Attribute<java.util.List> humanos = new Attribute<java.util.List> (){ @Override public java.util.List valueOfAttribute(Entity entity) { return ((Jazida)entity).getHumanos(); } }; public $Jazida(){ this.uuid = Uuid.generator(); } public $Jazida(Jazida obj){ this.setBase(obj.getBase()); this.setAltura(obj.getAltura()); this.setLatitude(obj.getLatitude()); this.setLongitude(obj.getLongitude()); this.setPovoada(obj.isPovoada()); this.setExplorada(obj.isExplorada()); this.setRegiao(obj.getRegiao()); this.setColonias(obj.getColonias()); this.setMaquinas(obj.getMaquinas()); this.setHumanos(obj.getHumanos()); this.uuid = Uuid.generator(); } public $Jazida(Jazida obj, Uuid uuid){ this.setBase(obj.getBase()); this.setAltura(obj.getAltura()); this.setLatitude(obj.getLatitude()); this.setLongitude(obj.getLongitude()); this.setPovoada(obj.isPovoada()); this.setExplorada(obj.isExplorada()); this.setRegiao(obj.getRegiao()); this.setColonias(obj.getColonias()); this.setMaquinas(obj.getMaquinas()); this.setHumanos(obj.getHumanos()); this.uuid = uuid; } public $Jazida($Jazida obj){ this.setBase(obj.getBase()); this.setAltura(obj.getAltura()); this.setLatitude(obj.getLatitude()); this.setLongitude(obj.getLongitude()); this.setPovoada(obj.isPovoada()); this.setExplorada(obj.isExplorada()); this.setRegiao(obj.getRegiao()); this.setColonias(obj.getColonias()); this.setMaquinas(obj.getMaquinas()); this.setHumanos(obj.getHumanos()); this.uuid = obj.getUuid();; } public $Jazida(Uuid uuid){ this.uuid = uuid; } protected Uuid uuidRegiao; @Override public Regiao getRegiao(){ Regiao superRegiao = super.getRegiao(); if (superRegiao == null && uuidRegiao != null) {superRegiao = $Regiao.entityStructure.find(uuidRegiao); this.setRegiao(superRegiao); }return superRegiao; }private void resetUuidRegiao() { if (this.getRegiao() != null) { if (this.getRegiao() instanceof Entity) { uuidRegiao = ((Entity) this.getRegiao()).getUuid(); } else { $Regiao entity = new $Regiao (this.getRegiao()); uuidRegiao = $Regiao.find(entity); if (uuidRegiao == null) { throw new TransientObjectException("Jazida", "regiao", "Regiao"); } } } }protected java.util.List<Uuid> uuidColonias = new java.util.ArrayList<>(); @Override public java.util.List<org.obinject.sample.avatar.Colonia> getColonias() {java.util.List<org.obinject.sample.avatar.Colonia> superColonias = super.getColonias(); if ((superColonias.isEmpty()) && (!uuidColonias.isEmpty())) {for (Uuid uuid : uuidColonias) {superColonias.add($Colonia.entityStructure.find(uuid)); } }return superColonias; }private void resetUuidColonias(){ uuidColonias.clear(); if (this.getColonias() != null) {for (Colonia obj : this.getColonias()) { if (obj instanceof Entity) { uuidColonias.add(((Entity) obj).getUuid()); } else { $Colonia entity = new $Colonia (obj); uuidColonias.add($Colonia.find(entity)); if (uuidColonias == null) { throw new TransientObjectException("Jazida", "colonias", "Colonia"); } } } } }protected java.util.List<Uuid> uuidMaquinas = new java.util.ArrayList<>(); @Override public java.util.List<org.obinject.sample.avatar.Maquinario> getMaquinas() {java.util.List<org.obinject.sample.avatar.Maquinario> superMaquinas = super.getMaquinas(); if ((superMaquinas.isEmpty()) && (!uuidMaquinas.isEmpty())) {for (Uuid uuid : uuidMaquinas) {superMaquinas.add($Maquinario.entityStructure.find(uuid)); } }return superMaquinas; }private void resetUuidMaquinas(){ uuidMaquinas.clear(); if (this.getMaquinas() != null) {for (Maquinario obj : this.getMaquinas()) { if (obj instanceof Entity) { uuidMaquinas.add(((Entity) obj).getUuid()); } else { $Maquinario entity = new $Maquinario (obj); uuidMaquinas.add($Maquinario.find(entity)); if (uuidMaquinas == null) { throw new TransientObjectException("Jazida", "maquinas", "Maquinario"); } } } } }protected java.util.List<Uuid> uuidHumanos = new java.util.ArrayList<>(); @Override public java.util.List<org.obinject.sample.avatar.Humano> getHumanos() {java.util.List<org.obinject.sample.avatar.Humano> superHumanos = super.getHumanos(); if ((superHumanos.isEmpty()) && (!uuidHumanos.isEmpty())) {for (Uuid uuid : uuidHumanos) {superHumanos.add($Humano.entityStructure.find(uuid)); } }return superHumanos; }private void resetUuidHumanos(){ uuidHumanos.clear(); if (this.getHumanos() != null) {for (Humano obj : this.getHumanos()) { if (obj instanceof Entity) { uuidHumanos.add(((Entity) obj).getUuid()); } else { $Humano entity = new $Humano (obj); uuidHumanos.add($Humano.find(entity)); if (uuidHumanos == null) { throw new TransientObjectException("Jazida", "humanos", "Humano"); } } } } }@Override public boolean isEqual($Jazida obj) { return (this.getBase() == obj.getBase()) && (this.getAltura() == obj.getAltura()) && (this.getLatitude() == obj.getLatitude()) && (this.getLongitude() == obj.getLongitude()) && (this.isPovoada() == obj.isPovoada()) && (this.isExplorada() == obj.isExplorada()); } @Override public Uuid getUuid() { return this.uuid; } @Override public EntityStructure<$Jazida> getEntityStructure() { return entityStructure; } @Override public boolean inject(){ Uuid uuidInject = $Jazida.find(this); if(uuidInject == null){ resetUuidRegiao(); resetUuidColonias(); resetUuidMaquinas(); resetUuidHumanos(); $Jazida.entityStructure.add(this); UniqueOneJazida.uniqueOneJazidaStructure.add(new UniqueOneJazida(this, this.getUuid())); return true; }else{ this.uuid = uuidInject; return false; } } @Override public boolean reject(){ Uuid uuidReject = $Jazida.find(this); if(uuidReject != null){ UniqueOneJazida.uniqueOneJazidaStructure.remove(new UniqueOneJazida(this, this.getUuid())); $Jazida.entityStructure.remove(this); return true; }else{ return false; } } @Override public boolean modify(){ Uuid uuidOld = $Jazida.find(this); $Jazida entityOld = $Jazida.entityStructure.find(uuidOld); if(entityOld != null){ resetUuidRegiao(); resetUuidColonias(); resetUuidMaquinas(); resetUuidHumanos(); UniqueOneJazida uniqueOneJazidaOld = new UniqueOneJazida(entityOld, entityOld.getUuid()); UniqueOneJazida uniqueOneJazidaNew = new UniqueOneJazida(this, entityOld.getUuid()); if(uniqueOneJazidaOld.hasSameKey(uniqueOneJazidaNew)){ $Jazida.uniqueOneJazidaStructure.remove(uniqueOneJazidaOld); $Jazida.uniqueOneJazidaStructure.add(uniqueOneJazidaNew); } this.uuid = uuidOld; $Jazida.entityStructure.remove(entityOld); $Jazida.entityStructure.add(this); return true; }else{ return false; } } public static Uuid find($Jazida entity) { UniqueOneJazida unique = new UniqueOneJazida (entity, entity.getUuid()); return $Jazida.uniqueOneJazidaStructure.find(unique); } @Override public boolean pullEntity(byte[] array, int position) { PullPage pull = new PullPage(array, position); Uuid storedClass = pull.pullUuid(); if ($Jazida.classId.equals(storedClass) == true){ uuid = pull.pullUuid(); this.setBase(pull.pullInteger()); this.setAltura(pull.pullInteger()); this.setLatitude(pull.pullInteger()); this.setLongitude(pull.pullInteger()); this.setPovoada(pull.pullBoolean()); this.setExplorada(pull.pullBoolean()); int totalRegiao = pull.pullInteger(); if(totalRegiao > 0){this.uuidRegiao = pull.pullUuid(); }int totalColonias = pull.pullInteger(); for (int i = 0; i < totalColonias; i++) {this.uuidColonias.add(pull.pullUuid()); }int totalMaquinas = pull.pullInteger(); for (int i = 0; i < totalMaquinas; i++) {this.uuidMaquinas.add(pull.pullUuid()); }int totalHumanos = pull.pullInteger(); for (int i = 0; i < totalHumanos; i++) {this.uuidHumanos.add(pull.pullUuid()); }return true; } return false; } @Override public void pushEntity(byte[] array, int position){ PushPage push = new PushPage(array, position); push.pushUuid($Jazida.classId); push.pushUuid(uuid); push.pushInteger(this.getBase()); push.pushInteger(this.getAltura()); push.pushInteger(this.getLatitude()); push.pushInteger(this.getLongitude()); push.pushBoolean(this.isPovoada()); push.pushBoolean(this.isExplorada()); if (this.uuidRegiao != null) { push.pushInteger(1); push.pushUuid(this.uuidRegiao); } else {push.pushInteger(0); } push.pushInteger(this.uuidColonias.size()); for (Uuid uuidPush : this.uuidColonias) {push.pushUuid(uuidPush); }push.pushInteger(this.uuidMaquinas.size()); for (Uuid uuidPush : this.uuidMaquinas) {push.pushUuid(uuidPush); }push.pushInteger(this.uuidHumanos.size()); for (Uuid uuidPush : this.uuidHumanos) {push.pushUuid(uuidPush); }} @Override public int sizeOfEntity() { return Page.sizeOfUuid + Page.sizeOfUuid  + Page.sizeOfInteger + Page.sizeOfInteger + Page.sizeOfInteger + Page.sizeOfInteger + Page.sizeOfBoolean + Page.sizeOfBoolean + Page.sizeOfEntity(this.uuidRegiao) + Page.sizeOfEntityCollection(this.uuidColonias) + Page.sizeOfEntityCollection(this.uuidMaquinas) + Page.sizeOfEntityCollection(this.uuidHumanos); } static{ latitude.getSchemas().add( new Schema<$Jazida, UniqueOneJazida, Integer>() { @Override public $Jazida newEntity(Integer value) { $Jazida obj = new $Jazida(); obj.setLatitude(value); return obj; } @Override public UniqueOneJazida newKey(Integer value) { UniqueOneJazida obj = new UniqueOneJazida(); obj.setLatitude(value); return obj; } @Override public EntityStructure<$Jazida> getEntityStructure() { return $Jazida.entityStructure; } @Override public KeyStructure<UniqueOneJazida> getKeyStructure() { return UniqueOneJazida.uniqueOneJazidaStructure; } } ); longitude.getSchemas().add( new Schema<$Jazida, UniqueOneJazida, Integer>() { @Override public $Jazida newEntity(Integer value) { $Jazida obj = new $Jazida(); obj.setLongitude(value); return obj; } @Override public UniqueOneJazida newKey(Integer value) { UniqueOneJazida obj = new UniqueOneJazida(); obj.setLongitude(value); return obj; } @Override public EntityStructure<$Jazida> getEntityStructure() { return $Jazida.entityStructure; } @Override public KeyStructure<UniqueOneJazida> getKeyStructure() { return UniqueOneJazida.uniqueOneJazidaStructure; } } ); } } 